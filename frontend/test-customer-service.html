<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äººå·¥å®¢æœæµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .test-container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        button {
            background: #db0011;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #ff4757;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        input, textarea {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ§ª äººå·¥å®¢æœåŠŸèƒ½æµ‹è¯•</h1>
        
        <div class="test-section">
            <h3>1. æµ‹è¯•APIè¿æ¥</h3>
            <button onclick="testAPI()">æµ‹è¯• API è¿æ¥</button>
            <div id="apiLog" class="log"></div>
        </div>
        
        <div class="test-section">
            <h3>2. æ¨¡æ‹Ÿå‰ç«¯è°ƒç”¨</h3>
            <input type="text" id="testMessage" placeholder="è¾“å…¥æµ‹è¯•æ¶ˆæ¯" value="ä½ å¥½ï¼Œè¿™æ˜¯æµ‹è¯•æ¶ˆæ¯">
            <button onclick="testFrontendCall()">å‘é€æ¶ˆæ¯ï¼ˆæ¨¡æ‹Ÿå‰ç«¯ï¼‰</button>
            <div id="frontendLog" class="log"></div>
        </div>
        
        <div class="test-section">
            <h3>3. æ£€æŸ¥ç½‘ç»œè¯·æ±‚</h3>
            <p>è¯·æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·çš„Networké¢æ¿ï¼Œç„¶åç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®:</p>
            <button onclick="testNetworkCall()">å‘é€ç½‘ç»œè¯·æ±‚ï¼ˆæŸ¥çœ‹Networkï¼‰</button>
            <div id="networkLog" class="log"></div>
        </div>
        
        <div class="test-section">
            <h3>4. æ§åˆ¶å°æ—¥å¿—</h3>
            <div id="consoleLog" class="log"></div>
        </div>
    </div>

    <script>
        // é‡å†™console.logæ¥æ˜¾ç¤ºåœ¨é¡µé¢ä¸Š
        const originalLog = console.log;
        const originalError = console.error;
        
        function addToConsoleLog(message, type = 'log') {
            const consoleLog = document.getElementById('consoleLog');
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? 'red' : type === 'warn' ? 'orange' : 'black';
            consoleLog.innerHTML += `<div style="color: ${color}">[${timestamp}] ${message}</div>`;
            consoleLog.scrollTop = consoleLog.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addToConsoleLog(args.join(' '), 'log');
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addToConsoleLog(args.join(' '), 'error');
        };

        // æµ‹è¯•1: APIè¿æ¥
        async function testAPI() {
            const apiLog = document.getElementById('apiLog');
            apiLog.innerHTML = 'å¼€å§‹æµ‹è¯•APIè¿æ¥...<br>';
            
            try {
                console.log('=== æµ‹è¯•APIè¿æ¥ ===');
                
                const response = await fetch('http://localhost:3000/api/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ message: 'APIæµ‹è¯•æ¶ˆæ¯' })
                });
                
                console.log('APIå“åº”çŠ¶æ€:', response.status);
                apiLog.innerHTML += `APIå“åº”çŠ¶æ€: ${response.status}<br>`;
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('APIå“åº”æ•°æ®:', data);
                
                if (data.success) {
                    apiLog.innerHTML += `âœ… APIè¿æ¥æˆåŠŸ!<br>`;
                    apiLog.innerHTML += `Qwenå›å¤: ${data.response.substring(0, 100)}...<br>`;
                } else {
                    apiLog.innerHTML += `âŒ APIè¿”å›å¤±è´¥: ${JSON.stringify(data)}<br>`;
                }
                
            } catch (error) {
                console.error('APIæµ‹è¯•å¤±è´¥:', error);
                apiLog.innerHTML += `âŒ APIæµ‹è¯•å¤±è´¥: ${error.message}<br>`;
            }
        }

        // æµ‹è¯•2: æ¨¡æ‹Ÿå‰ç«¯è°ƒç”¨
        async function testFrontendCall() {
            const frontendLog = document.getElementById('frontendLog');
            const message = document.getElementById('testMessage').value;
            
            frontendLog.innerHTML = 'å¼€å§‹æ¨¡æ‹Ÿå‰ç«¯è°ƒç”¨...<br>';
            
            try {
                console.log('=== æ¨¡æ‹Ÿå‰ç«¯callCustomerQwenAPIå‡½æ•° ===');
                console.log('ç”¨æˆ·æ¶ˆæ¯:', message);
                
                frontendLog.innerHTML += `å‘é€æ¶ˆæ¯: ${message}<br>`;
                
                // æ¨¡æ‹Ÿ callCustomerQwenAPI å‡½æ•°
                const response = await fetch('http://localhost:3000/api/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ message: message })
                });

                console.log('APIå“åº”çŠ¶æ€:', response.status);
                frontendLog.innerHTML += `APIå“åº”çŠ¶æ€: ${response.status}<br>`;

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                console.log('APIå“åº”æ•°æ®:', data);
                
                if (data.success) {
                    const aiResponse = data.response;
                    console.log('AIå›å¤:', aiResponse);
                    frontendLog.innerHTML += `âœ… å‰ç«¯è°ƒç”¨æˆåŠŸ!<br>`;
                    frontendLog.innerHTML += `AIå›å¤: ${aiResponse.substring(0, 200)}...<br>`;
                } else {
                    console.error('APIè¿”å›å¤±è´¥:', data);
                    frontendLog.innerHTML += `âŒ APIè¿”å›å¤±è´¥: ${JSON.stringify(data)}<br>`;
                }
                
            } catch (error) {
                console.error('å‰ç«¯è°ƒç”¨å¤±è´¥:', error);
                frontendLog.innerHTML += `âŒ å‰ç«¯è°ƒç”¨å¤±è´¥: ${error.message}<br>`;
            }
        }

        // æµ‹è¯•3: ç½‘ç»œè¯·æ±‚
        async function testNetworkCall() {
            const networkLog = document.getElementById('networkLog');
            networkLog.innerHTML = 'å‘é€ç½‘ç»œè¯·æ±‚ä¸­...<br>';
            
            try {
                console.log('=== å‘é€ç½‘ç»œè¯·æ±‚æµ‹è¯• ===');
                
                const startTime = Date.now();
                
                const response = await fetch('http://localhost:3000/api/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ message: 'ç½‘ç»œæµ‹è¯•æ¶ˆæ¯' })
                });
                
                const endTime = Date.now();
                const duration = endTime - startTime;
                
                networkLog.innerHTML += `è¯·æ±‚è€—æ—¶: ${duration}ms<br>`;
                networkLog.innerHTML += `å“åº”çŠ¶æ€: ${response.status}<br>`;
                networkLog.innerHTML += `å“åº”å¤´: ${JSON.stringify([...response.headers.entries()])}<br>`;
                
                const text = await response.text();
                networkLog.innerHTML += `å“åº”å†…å®¹: ${text.substring(0, 300)}...<br>`;
                
                console.log('ç½‘ç»œè¯·æ±‚å®Œæˆ');
                
            } catch (error) {
                console.error('ç½‘ç»œè¯·æ±‚å¤±è´¥:', error);
                networkLog.innerHTML += `âŒ ç½‘ç»œè¯·æ±‚å¤±è´¥: ${error.message}<br>`;
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåè¿è¡Œä¸€äº›åŸºæœ¬æ£€æµ‹
        window.addEventListener('load', function() {
            console.log('æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ');
            console.log('å½“å‰URL:', window.location.href);
            console.log('fetchå‡½æ•°å¯ç”¨:', typeof fetch !== 'undefined');
        });
    </script>
</body>
</html>
